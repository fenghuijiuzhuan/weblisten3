<!DOCTYPE html>
<html lang="ch">
  <head>
    <title>配置监测选项</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/src/static/css/common/base.css">
    <link rel="stylesheet" href="/frame/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="/frame/layui/css/admin.css"  media="all">
    <link rel="stylesheet" href="/src/static/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/src/static/css/common/comm.css">
    <script src="/lib/require-2.1.11.min.js"></script>
    <script src="/frame/echarts-2.2.7/dist/echarts.js"></script>
    <style>.hide{display:none}</style>
  </head>
<body>
  <!-- 哎呀 什么都没有 -->
<script>
require(['/src/config/require.config.js'], function () {
  require(['/src/js/content_iframe.js', 'echarts/chart/bar', 'echarts/chart/pie'], function (Moo) {
    var body = Moo.body,
      bread = Moo.bread,
      bodytitle = Moo.bodytitle,
      panel = Moo.panel,
      ec = Moo.ec;

    var t = new Date().getTime()
    console.log(t)
    var d = new Date(t)
    console.log(d.format("yyyy年MM月dd日"))
    // main body
    var bod = body.create().appendTo($('body'));
    bod.eq(1).css({
      top: 0, 
      left: 0,
      bottom: 0
    })
    var main = bod.find('.wping-bodymain');
    var content = bod.find('.wping-bodycontent');
    
    // bread
    // bread.create(bod, [{title: '全媒体采编',}, {title: '已签发平台',}])

    // search-from
    // search.create(main)
    bodytitle.create(content, { title: '首页栏目添加' })


    // 首页栏目添加table
    var panelParam = {
      title: '要闻',
      body: '<div class="main-table"><table class="layui-table layui-form" id="test-tree-table"></table></div>'
    }
    panel.create(content, panelParam, function (dom) {
      var icon = dom.find('.layui-icon');
      var tablebox = dom.find('.main-table');
      // var titlebox = dom.find('.main-table-title');
      // titlebox.prependTo(titlebox.parent());
      var treetablebox = tablebox.find('#test-tree-table');
      layui.extend({
        treetable:'/src/module/treetable'
      }).use(['treetable', 'form'],function(){
          var data=[{"id":1,"pid":0,"title":"1-1"},{"id":2,"pid":0,"title":"1-2"},{"id":3,"pid":0,"title":"1-3"},{"id":4,"pid":1,"title":"1-1-1"},{"id":5,"pid":1,"title":"1-1-2"},{"id":6,"pid":2,"title":"1-2-1"},{"id":7,"pid":2,"title":"1-2-3"},{"id":8,"pid":3,"title":"1-3-1"},{"id":9,"pid":3,"title":"1-3-2"},{"id":10,"pid":4,"title":"1-1-1-1"},{"id":11,"pid":4,"title":"1-1-1-2"}];
          var o = layui.$,treetable = layui.treetable;
          var form = layui.form,layer = layui.layer;
          treetable.render({
            elem: treetablebox[0],
            data: data,
            field: 'title',
            is_checkbox: true,
            /*icon_val: {
              open: "&#xe619;",
              close: "&#xe61a;"
            },
            space: 4,*/
            cols: [
              {
                field: 'title',
                title: '标题',
                width: '20%'
              },
              {
                field: 'id',
                title: 'ID',
                width: '10%'
              },
              {
                title: '状态',
                width: '10%',
                template: function(item){
                  return '<input type="checkbox" lay-skin="switch" lay-filter="status" lay-text="开启|关闭">';
                }
              },
              {
                field: 'pid',
                title: '父ID',
                width: '10%',
              },
              {
                field: 'actions',
                title: '操作',
                width: '40%',
                template: function(item){
                  var tem = [];
                  if(item.pid == 0){
                    tem.push('<a class="add-child layui-btn layui-btn-sm layui-btn-normal" lay-filter="add">添加子级</a>');
                  }
                  tem.push('<a lay-filter="edit" class="layui-btn layui-btn-sm layui-btn-normal">编辑</a>');
                  if(item.pid > 0){
                    tem.push('<a lay-filter="set" class="set-attr layui-btn layui-btn-sm layui-btn-normal">设置属性</a>');
                  }
                  return tem.join('')
                },
              },
            ]
          });

          treetable.on('treetable(add)',function(data){
            layer.msg('添加操作');
            console.dir(data);
          })
          
          treetable.on('treetable(edit)',function(data){
            layer.msg('编辑操作');
            console.dir(data);
          })
          
          $('.up-all').click(function(){
            treetable.all('up');
          })
          
          $('.down-all').click(function(){
            treetable.all('down');
          })
          
          $('.get-checked').click(function(){
            console.dir(treetable.all('checked'));
          })
          
          form.on('switch(status)',function(data){
            layer.msg('监听状态操作');
            console.dir(data);
          })
        })
      

    })
  })
})
</script>
</body>
</html>